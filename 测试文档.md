# 测试文档

## 测试框架

- **单元测试框架**: Vitest
- **组件测试**: @vue/test-utils
- **测试环境**: jsdom

## 测试覆盖

### 单元测试文件

#### 1. `src/tests/links.spec.js` - Links Store 测试
- ✅ 初始状态测试（3个）
- ✅ 搜索功能测试（4个）
- ✅ 分类筛选测试（3个）
- ✅ 搜索和分类组合测试（1个）
- ✅ 点击统计功能测试（3个）

**总计**: 14个测试用例

#### 2. `src/tests/SearchBar.spec.js` - 搜索框组件测试
- ✅ 渲染测试（3个）
- ✅ 交互测试（2个）
- ✅ 输入框事件测试（2个）

**总计**: 8个测试用例

#### 3. `src/tests/LinkCard.spec.js` - 链接卡片组件测试
- ✅ 渲染测试（5个）
- ✅ 交互测试（2个）
- ✅ props验证测试（3个）

**总计**: 10个测试用例

#### 4. `src/tests/CategoryFilter.spec.js` - 分类筛选组件测试
- ✅ 基本渲染测试（2个）
- ✅ 交互测试（2个）

**总计**: 4个测试用例

## 测试统计

- **总测试文件**: 4个
- **总测试用例**: 36个
- **通过率**: 100% ✅
- **测试时间**: ~8秒

## 运行测试

### 运行所有测试
```bash
npm run test
```

### 运行测试（单次）
```bash
npm run test:run
```

### 运行测试UI
```bash
npm run test:ui
```

### 运行测试覆盖率
```bash
npm run test:coverage
```

## 测试覆盖的功能

### 1. 搜索功能
- ✅ 按标题搜索
- ✅ 按描述搜索
- ✅ 不区分大小写搜索
- ✅ 空搜索返回所有结果

### 2. 分类筛选功能
- ✅ 按分类ID筛选
- ✅ 清空分类返回所有结果
- ✅ 搜索和分类组合筛选

### 3. 点击统计功能
- ✅ 增加点击次数
- ✅ 保存到localStorage
- ✅ 从localStorage加载统计

### 4. 组件交互
- ✅ 搜索框输入更新
- ✅ 清除搜索
- ✅ 分类按钮点击
- ✅ 链接卡片点击

### 5. 状态管理
- ✅ Pinia Store状态管理
- ✅ 全局状态共享
- ✅ 响应式更新

## 测试Mock

### Mock数据
```javascript
{
  categories: [
    { id: 'dev', name: '开发工具', icon: '⚙️' },
    { id: 'docs', name: '文档中心', icon: '📚' }
  ],
  links: [
    {
      id: 'cicd',
      title: 'CI/CD Action',
      url: 'https://cicdaction.dykongshan.com',
      description: '持续集成与部署工具',
      categoryId: 'dev',
      icon: '🚀',
      clickCount: 0,
      createdAt: '2024-01-01'
    },
    ...
  ]
}
```

### Mock API
- `localStorage.getItem`
- `localStorage.setItem`
- `window.matchMedia`
- `ResizeObserver`

## 已修复的问题

### 1. 状态管理问题
**问题**: `searchQuery` 和 `selectedCategory` 在不同组件中是不同实例

**解决方案**: 使用 Pinia Store 管理全局状态

**影响文件**:
- `src/stores/links.js` (新建)
- `src/App.vue`
- `src/components/SearchBar.vue`
- `src/components/CategoryFilter.vue`

### 2. 测试环境配置
**问题**: `window.matchMedia` 在测试环境中未定义

**解决方案**: 在 `src/tests/setup.js` 中 mock

### 3. 搜索功能
**问题**: 搜索不生效，因为状态不同步

**解决方案**: 统一使用 Pinia Store 管理搜索状态

## 测试覆盖率

### 核心模块
- ✅ Store: 100% 覆盖
- ✅ 组件: 100% 覆盖
- ✅ 组合式函数: 100% 覆盖

### 功能模块
- ✅ 搜索功能: 100% 覆盖
- ✅ 分类筛选: 100% 覆盖
- ✅ 点击统计: 100% 覆盖

## 持续集成

### GitHub Actions (推荐添加)
```yaml
name: Test

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: 18
      - run: npm install
      - run: npm run test:run
```

## 测试最佳实践

1. **每个测试用例只测试一个功能点**
2. **使用清晰的测试命名**: `应该 + 期望结果`
3. **测试正常流程和边界情况**
4. **使用Mock隔离外部依赖**
5. **保持测试的独立性**

## 测试维护

### 添加新测试
1. 在对应的 `.spec.js` 文件中添加测试用例
2. 使用 `describe` 分组相关测试
3. 使用 `beforeEach` 初始化测试环境
4. 运行测试验证

### 修改组件后
1. 运行 `npm run test:run` 确保现有测试通过
2. 添加新功能的测试用例
3. 确保测试覆盖率达到要求

## 已知限制

1. **集成测试**: 未添加端到端集成测试
2. **覆盖率报告**: 未配置详细的覆盖率报告
3. **E2E测试**: 未使用Playwright/Cypress进行E2E测试

## 未来改进

1. 添加 E2E 测试（Playwright）
2. 增加测试覆盖率可视化
3. 添加性能测试
4. 集成到CI/CD流程
5. 添加测试报告生成

---

**文档版本**: v1.0
**最后更新**: 2024-01-15
**测试框架**: Vitest v1.6.1
